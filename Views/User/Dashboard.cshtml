@model Bank2.Models.SharedData
@{
  var Username = Context.Session.GetString("Username");
  var UserId = Context.Session.GetString("UserId");
  ViewData["Title"] = "Dashboard";
}

<!DOCTYPE html>
<html lang="en">
<head>
  <title></title>
  <link rel="stylesheet" href="~/css/Dashboard.css"/>
</head>
<body class="dashboardContentBody">
  <header class="baseSection">
    <h1 class="removeMargin">Billing and Payments</h1>
    <select id="selectedAccount" class="selectFieldDropdown" asp-items="ViewBag.Accounts"></select>

  </header>
  <section id="showTransaction" class="twoColumn">

     @*
     <section class="baseSection"> 
       <h2 class="dashboardSectionHeading">Primary payments A/C</h2> 
       <div class="bankAccountCard"> 
         <div class="bankCardContents"> 
           <p>@Model.User.Branch.Name Branch</p> 
           <p>@Model.Account[0].AccountNo</p> 
         </div> 
         <p class="bankCardBalance">₹ @Model.Account[0].AccountBalance</p> 
         <div class="bankCardContents"> 
           <p>@Model.User.Username</p> 
         </div> 
       </div> 
     </section> 

     <section class="baseSection">
       <h2 class="dashboardSectionHeading">Recent Transaction</h2> 
       <table> 
         <thead> 
           <tr> 
             <th>AccountNo</th> 
             <th>Type</th> 
             <th>Amount</th> 
             <th>DateTime</th> 
           </tr> 
         </thead> 
         <tbody> 
            @if (Model.Transactions.Count == 0) 
            {  
              <tr>  
                <td colspan="4" style="text-align: center;">  
                  -------------------- No Entries --------------------  
                </td>  
              </tr>
            }  
            @foreach (var tran in Model.Transactions.Take(5))  
            {  
              <tr>  
                <td>@tran.AccountNumber</td>  
                <td style="color:@(tran.Type == "Debit" ? "forestgreen" : "red")">@tran.Type</td>
                <td style="color:@(tran.Type == "Debit" ? "forestgreen" : "red")">@tran.Amount</td>
                <td>@tran.Date</td>  
              </tr>  
            } 
         </tbody> 
       </table> 
     </section> 
     *@
  </section>

  <section class="baseSection">
    <fieldset class="paymentsContents">
      <legend class="paymentLegend">Quick Access</legend>
        <a class="paymentItem" asp-for="" asp-controller="Transaction" asp-action="Payment">
          <img class="paymentItemLogo" src="~/ico/phone-list.png" alt="itemImage" />
          <h3 class="paymentItemName">Pay Contact</h3>
        </a>
        <a class="paymentItem" asp-for="" asp-controller="Transaction" asp-action="Payment">
          <img class="paymentItemLogo" src="~/ico/donation.png" alt="itemImage" />
          <h3 class="paymentItemName">Pay Phone Number</h3>
        </a>
        <a class="paymentItem" asp-for="" asp-controller="Transaction" asp-action="Payment">
          <img class="paymentItemLogo" src="~/ico/mobile-recharge.png" alt="itemImage" />
          <h3 class="paymentItemName">Mobile Recharge</h3>
        </a>
        <a class="paymentItem" asp-for="" asp-controller="Transaction" asp-action="Payment">
          <img class="paymentItemLogo" src="~/ico/mobile-postpaid.png" alt="itemImage" />
          <h3 class="paymentItemName">Mobile Postpaid</h3>
        </a>
    </fieldset>
  </section>
  <section class="baseSection">
    <h2 class="removeMargin">Recommended</h2>
  </section>
  
  <script>
    if(document.getElementById("selectedAccount").value != null)
    {
      (async () => {
        const accountId = document.getElementById("selectedAccount").value;
        console.log("Selected Account : " + accountId);
        const response = await fetch(`/Transaction/getTransaction?accountId=${accountId}`);
        const transactionHTML = await response.text();
        document.getElementById("showTransaction").innerHTML = transactionHTML;
      })();
    }

    document.getElementById("selectedAccount").addEventListener("change",
      async function() {
        const accountId = document.getElementById("selectedAccount").value;
        console.log("Selected Account : " + accountId);
        const response = await fetch(`/Transaction/getTransaction?accountId=${accountId}`);
        const transactionHTML = await response.text();
        document.getElementById("showTransaction").innerHTML = transactionHTML;
      }
    );
  </script>
</body>
</html>